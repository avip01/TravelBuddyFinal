// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  username     String    @unique
  displayName  String
  profilePhoto String?
  age          Int?
  gender       Gender?
  interests    String[]
  isVerified   Boolean   @default(false)
  lastActive   DateTime? @default(now())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  trips            Trip[]
  sentMessages     Message[]       @relation("SentMessages")
  chatParticipants ChatParticipant[]
  notifications    Notification[]

  @@map("users")
}

model Trip {
  id                String            @id @default(cuid())
  userId            String
  title             String
  description       String?
  destination       String
  startDate         DateTime
  endDate           DateTime
  budget            Float
  interests         String[]
  accommodationType AccommodationType?
  isPublic          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("trips")
}

model Chat {
  id        String   @id @default(cuid())
  isGroup   Boolean  @default(false)
  title     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  participants ChatParticipant[]
  messages     Message[]

  @@map("chats")
}

model ChatParticipant {
  id           String    @id @default(cuid())
  userId       String
  chatId       String
  isArchived   Boolean   @default(false)
  joinedAt     DateTime  @default(now())
  lastReadAt   DateTime?
  leftAt       DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([userId, chatId])
  @@map("chat_participants")
}

model Message {
  id          String      @id @default(cuid())
  chatId      String
  senderId    String
  content     String
  messageType MessageType @default(TEXT)
  imageUrl    String?
  location    Json?
  isEdited    Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Destination {
  id                String   @id @default(cuid())
  name              String
  country           String
  description       String
  imageUrl          String
  latitude          Float
  longitude         Float
  popularActivities String[]
  budgetLow         Float
  budgetMedium      Float
  budgetHigh        Float
  bestTimeToVisit   String[]
  rating            Float    @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("destinations")
}

model FlightInfo {
  id                   String        @id @default(cuid())
  flightNumber         String        @unique
  airline              String
  departureAirport     String
  departureTerminal    String?
  departureGate        String?
  scheduledDeparture   DateTime
  estimatedDeparture   DateTime?
  actualDeparture      DateTime?
  arrivalAirport       String
  arrivalTerminal      String?
  arrivalGate          String?
  scheduledArrival     DateTime
  estimatedArrival     DateTime?
  actualArrival        DateTime?
  status               FlightStatus
  aircraft             String?
  lastUpdated          DateTime      @default(now())
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  @@map("flight_info")
}

model CruiseInfo {
  id                String    @id @default(cuid())
  shipId            String    @unique
  shipName          String
  cruiseLine        String
  currentPortName   String?
  currentPortCountry String?
  portArrivalTime   DateTime?
  portDepartureTime DateTime?
  nextPortName      String?
  nextPortCountry   String?
  nextPortETA       DateTime?
  lastUpdated       DateTime  @default(now())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@map("cruise_info")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  body      String
  data      Json?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model MapMarker {
  id          String     @id @default(cuid())
  type        MarkerType
  title       String
  description String
  latitude    Float
  longitude   Float
  category    String
  rating      Float?
  imageUrl    String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@map("map_markers")
}

// Enums
enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum AccommodationType {
  HOTEL
  HOSTEL
  AIRBNB
  CAMPING
  OTHER
}

enum MessageType {
  TEXT
  IMAGE
  LOCATION
}

enum FlightStatus {
  SCHEDULED
  BOARDING
  DEPARTED
  ARRIVED
  DELAYED
  CANCELLED
}

enum NotificationType {
  MESSAGE
  TRIP_MATCH
  FRIEND_REQUEST
  VERIFICATION
  SYSTEM
}

enum MarkerType {
  RESTAURANT
  ACCOMMODATION
  ATTRACTION
  USER
} 